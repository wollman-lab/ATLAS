
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Analysis package &#8212; dredFISH  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinxdoc.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">dredFISH  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Analysis package</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="analysis-package">
<h1>Analysis package<a class="headerlink" href="#analysis-package" title="Permalink to this heading">¶</a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this heading">¶</a></h2>
</section>
<section id="module-Analysis.Classification">
<span id="analysis-classification-module"></span><h2>Analysis.Classification module<a class="headerlink" href="#module-Analysis.Classification" title="Permalink to this heading">¶</a></h2>
<p>Classification of biospatial units in TMG analysis</p>
<p>This module contains the main classes related to the task of classification of biospatial units (i.e. cells, isozones, regions) into type.
The module is composed of a class hierarchy of classifiers. The “root” of this heirarchy is an abstract base class “Classifier” that has two
abstract methods (train and classify) that any subclass will have to implement.</p>
<dl class="py class">
<dt class="sig sig-object py" id="Analysis.Classification.Classifier">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">Analysis.Classification.</span></span><span class="sig-name descname"><span class="pre">Classifier</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.Classification.Classifier" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Interface for classifiers</p>
<p>This is an abstract class that defines the interface (i.e. methods and attributes) that all different classifiers must have.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="Analysis.Classification.Classifier.tax">
<span class="sig-name descname"><span class="pre">tax</span></span><a class="headerlink" href="#Analysis.Classification.Classifier.tax" title="Permalink to this definition">¶</a></dt>
<dd><p>A taxonomy system that the classifier classifies into.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#Analysis.TissueGraph.Taxonomy" title="Analysis.TissueGraph.Taxonomy">Taxonomy</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.Classification.Classifier.classify">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">classify</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.Classification.Classifier.classify" title="Permalink to this definition">¶</a></dt>
<dd><p>Classifies input into types</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.Classification.Classifier.train">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.Classification.Classifier.train" title="Permalink to this definition">¶</a></dt>
<dd><p>Trains a classifier</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="Analysis.Classification.KNNClassifier">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">Analysis.Classification.</span></span><span class="sig-name descname"><span class="pre">KNNClassifier</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">approx_nn</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">30</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'correlation'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.Classification.KNNClassifier" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#Analysis.Classification.Classifier" title="Analysis.Classification.Classifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">Classifier</span></code></a></p>
<p>k-nearest-neighbor classifier</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="Analysis.Classification.KNNClassifier.k">
<span class="sig-name descname"><span class="pre">k</span></span><a class="headerlink" href="#Analysis.Classification.KNNClassifier.k" title="Permalink to this definition">¶</a></dt>
<dd><p>The number of local neighbors to consider</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int (default = 1)</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="Analysis.Classification.KNNClassifier.approx_nn">
<span class="sig-name descname"><span class="pre">approx_nn</span></span><a class="headerlink" href="#Analysis.Classification.KNNClassifier.approx_nn" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of NN used by pynndescent to construct the approximate knn graph</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int (default = 30)</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="Analysis.Classification.KNNClassifier.metric">
<span class="sig-name descname"><span class="pre">metric</span></span><a class="headerlink" href="#Analysis.Classification.KNNClassifier.metric" title="Permalink to this definition">¶</a></dt>
<dd><p>What metric to use to determine similarity</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str (default = ‘correlation’)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.Classification.KNNClassifier.classify">
<span class="sig-name descname"><span class="pre">classify</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.Classification.KNNClassifier.classify" title="Permalink to this definition">¶</a></dt>
<dd><p>Find class of rows in data based on approx. KNN</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.Classification.KNNClassifier.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ref_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_label_id</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.Classification.KNNClassifier.train" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds approx. KNN graph for queries</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="Analysis.Classification.OptimalLeidenKNNClassifier">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">Analysis.Classification.</span></span><span class="sig-name descname"><span class="pre">OptimalLeidenKNNClassifier</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">TG</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.Classification.OptimalLeidenKNNClassifier" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#Analysis.Classification.KNNClassifier" title="Analysis.Classification.KNNClassifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">KNNClassifier</span></code></a></p>
<p>Classifiy cells based on unsupervized Leiden</p>
<p>This classifiers is trained using unsupervized learning with later classification done by knn (k=1)
the implementations uses the same classify method is KNNClassifier.
The overladed train method does the unsupervized learning before calling super().train to create the KNN index.</p>
<dl class="py method">
<dt class="sig sig-object py" id="Analysis.Classification.OptimalLeidenKNNClassifier.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">opt_res</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opt_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'iters':</span> <span class="pre">10,</span> <span class="pre">'n_consensus':</span> <span class="pre">50}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.Classification.OptimalLeidenKNNClassifier.train" title="Permalink to this definition">¶</a></dt>
<dd><p>training for this class is performing optimal leiden clustering</p>
<p>Optimization is done over resolution parameter trying to maximize the TG conditional entropy.
The analysis uses the two graphs (spatial and features) and finds a resolution parameters that will maximize
the conditional entropy, H(Zone|Type).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>opt_params</strong> (<em>dict</em>) – Few parameters that control optimizaiton.
‘iter’ is the number of repeats in each optimization round.
‘n_consensus’ is the number of times to do the final clustering with optimal resolution.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="Analysis.Classification.TopicClassifier">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">Analysis.Classification.</span></span><span class="sig-name descname"><span class="pre">TopicClassifier</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">TG</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ordr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.Classification.TopicClassifier" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#Analysis.Classification.Classifier" title="Analysis.Classification.Classifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">Classifier</span></code></a></p>
<dl class="py method">
<dt class="sig sig-object py" id="Analysis.Classification.TopicClassifier.classify">
<span class="sig-name descname"><span class="pre">classify</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.Classification.TopicClassifier.classify" title="Permalink to this definition">¶</a></dt>
<dd><p>classify based on fitted LDA</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.Classification.TopicClassifier.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">use_parallel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_num_of_topics</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.Classification.TopicClassifier.train" title="Permalink to this definition">¶</a></dt>
<dd><p>fit multiple LDA models and chose the one with highest type entropy</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-Analysis.TissueGraph">
<span id="analysis-tissuegraph-module"></span><h2>Analysis.TissueGraph module<a class="headerlink" href="#module-Analysis.TissueGraph" title="Permalink to this heading">¶</a></h2>
<p>TissueMultiGraph Analysis module.</p>
<p>The module contains the three main classes required graph based tissue analysis:
TissueMultiGraph: the key organizing class used to create and manage graphs across layers (hence multi)
TissueGraph: Each layers (cells, zones, regions) is defined using spatial and feature graphs that are both part ot a single tissuegraph
Taxonomy: a container class that stores information about the taxonomical units (cell types, region types).</p>
<p class="rubric">Notes</p>
<p>In current implementation each TMG object is stored as multiple files in a single directory.
That is the same directory that stores all the input files used by TMG to create it’s different objects.
Only a single TMG object can exist in each directory. To create two TMG objects from the same data, just copy the raw data.</p>
<p class="rubric">Example</p>
<p>TMG is created in a folder with csv file(s) that have cells transcriptional state (<a href="#id1"><span class="problematic" id="id2">*</span></a>_matrix.csv) and other metadata information such as x,y, section information in (<a href="#id3"><span class="problematic" id="id4">*</span></a>_metadata.csv) files. The creation of TMG follows the methods to create different layers (create_cell_layer, create_zone_layer, create_region_layer) and creating Geoms using create_geoms.</p>
<dl class="py class">
<dt class="sig sig-object py" id="Analysis.TissueGraph.Taxonomy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">Analysis.TissueGraph.</span></span><span class="sig-name descname"><span class="pre">Taxonomy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Types</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_mat</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.Taxonomy" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Taxonomical system for different biospatial units (cells, isozones, regions)</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="Analysis.TissueGraph.Taxonomy.Name">
<span class="sig-name descname"><span class="pre">Name</span></span><a class="headerlink" href="#Analysis.TissueGraph.Taxonomy.Name" title="Permalink to this definition">¶</a></dt>
<dd><p>a name of the taxonomy (will be used to file io)</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="Analysis.TissueGraph.Taxonomy.Type">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Type</span></span><a class="headerlink" href="#Analysis.TissueGraph.Taxonomy.Type" title="Permalink to this definition">¶</a></dt>
<dd><p>Building blocks of this Taxonomy</p>
<p>Setter verify that there are no duplications.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.Taxonomy.add_types">
<span class="sig-name descname"><span class="pre">add_types</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_types</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">feature_mat</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.Taxonomy.add_types" title="Permalink to this definition">¶</a></dt>
<dd><p>add new types and their feature average to the Taxonomy</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="Analysis.TissueGraph.Taxonomy.feature_mat">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">feature_mat</span></span><a class="headerlink" href="#Analysis.TissueGraph.Taxonomy.feature_mat" title="Permalink to this definition">¶</a></dt>
<dd><p>feature values for all types in the taxonomy</p>
<p>Setter can get as input either numpy array (ordered same as self.Type) or pandas dataframe</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.Taxonomy.is_empty">
<span class="sig-name descname"><span class="pre">is_empty</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.Taxonomy.is_empty" title="Permalink to this definition">¶</a></dt>
<dd><p>determie if taxonomy is empty</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.Taxonomy.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">basepath</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.Taxonomy.load" title="Permalink to this definition">¶</a></dt>
<dd><p>save from basepath using Taxonomy name</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.Taxonomy.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">basepath</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.Taxonomy.save" title="Permalink to this definition">¶</a></dt>
<dd><p>save to basepath using Taxonomy name</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">Analysis.TissueGraph.</span></span><span class="sig-name descname"><span class="pre">TissueGraph</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_mat</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">basepath</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">layer_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">redo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Representation of transcriptional state of biospatial units as a graph.</p>
<p>TissueGraph (TG) is the core class used to analyze tissues using Graph representation.
TG stores a two layer graph G = {V,Es,Ef} where Es are spatial edges (physical neighbors) and Ef are feature neighnors.
TG stores information on position (XYS) and features that used to created these graphs using anndata object representation.
Each TG has a reference to a Taxonomy object that contains information on the types (</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>TissueGraph objects are typically not created on their own, but using method calls of TMG (create_{cell,isozones,regions}_layer)</p>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.tax">
<span class="sig-name descname"><span class="pre">tax</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.tax" title="Permalink to this definition">¶</a></dt>
<dd><p>a Taxonomy object that contain labels, type stats, and relationship between types.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#Analysis.TissueGraph.Taxonomy" title="Analysis.TissueGraph.Taxonomy">Taxonomy</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.SG">
<span class="sig-name descname"><span class="pre">SG</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.SG" title="Permalink to this definition">¶</a></dt>
<dd><p>Graph representation of the spatial relationship between biospatiual units (i.e. cells, zones, regions).
SG might include multiple componennts for multiple slice data and is non-weighted graph (1 - neighbors, 0 not neighbors).</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>iGraph</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.FG">
<span class="sig-name descname"><span class="pre">FG</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.FG" title="Permalink to this definition">¶</a></dt>
<dd><p>Graph representation of feature similarity between biospatial units.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>iGraph</p>
</dd>
</dl>
</dd></dl>

<dl class="simple">
<dt>main methods:</dt><dd><ul class="simple">
<li><p>contract_graph - find zones/region, i.e. spatially continous areas in the graph the same (cell/microenvironment) type</p></li>
<li><p>cond_entopy - calculates the conditional entropy of a graph given types (or uses defaults existing types)</p></li>
<li><p>watershed - devide into regions based on watershed</p></li>
</ul>
</dd>
</dl>
<dl class="py property">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.N">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">N</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.N" title="Permalink to this definition">¶</a></dt>
<dd><p>Size of the tissue graph
internally stored as igraph size</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.Nslices">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Nslices</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.Nslices" title="Permalink to this definition">¶</a></dt>
<dd><p>returns number of unique slices in TG</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Nslices</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.Ntypes">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Ntypes</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.Ntypes" title="Permalink to this definition">¶</a></dt>
<dd><p>returns number of unique types in the graph</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Ntypes</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.Slice">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Slice</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.Slice" title="Permalink to this definition">¶</a></dt>
<dd><p>dependent property - will query info from anndata and return</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Slice</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.Type">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Type</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.Type" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.Upstream">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Upstream</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.Upstream" title="Permalink to this definition">¶</a></dt>
<dd><p>mapping between current TG layer (self) and upstream layer
Return value has he length of upsteam level and index values of current layer</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.X">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">X</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.X" title="Permalink to this definition">¶</a></dt>
<dd><p>dependent property - will query info from Graph and return</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>X</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.XY">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">XY</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.XY" title="Permalink to this definition">¶</a></dt>
<dd><p>dependent property - will query info from anndata and return</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>XY</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.Y">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Y</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.Y" title="Permalink to this definition">¶</a></dt>
<dd><p>dependent property - will query info from Graph and return</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Y</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.build_feature_graph">
<span class="sig-name descname"><span class="pre">build_feature_graph</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_neighbors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">accuracy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'extras':</span> <span class="pre">1.5,</span> <span class="pre">'prob':</span> <span class="pre">1}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric_kwds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_graph</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.build_feature_graph" title="Permalink to this definition">¶</a></dt>
<dd><p>construct k-graph based on feature similarity</p>
<p>Create a kNN graph (an igraph object) based on feature similarity. The core of this method is the calculation on how to find neighbors.
If metric is “precomputed” the distances are assumed to be known and we’re almost done.
For all other metric values, we use pynndescent</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<em>numpy array</em>) – Either a distance matrix, i.e. squareform(pdist(feature_mat)) if metric = ‘precomputed’.  ) or just a feature_mat</p></li>
<li><p><strong>n_neighbors</strong> (<em>int</em>) – How many neighbors (k) should we use in the knn graph</p></li>
<li><p><strong>metric</strong> (<em>str</em>) – either “precomputed”, “random”, or one of the MANY metrics supported by pynndescent. Random is for debugging only.</p></li>
<li><p><strong>accuracy</strong> (<em>dict with fields: 'prob' and 'extras'</em>) – a dictionary with accuracy options for pynndescent. ‘prob’ should be in [0,1] and ‘extras’ is typically &gt;1.
accuracy[‘prob’] conrols the ‘diversify_prob’ and accuracy[‘extra’] the ‘pruning_degree_multplier’</p></li>
<li><p><strong>metric_kwds</strong> (<em>dict</em>) – passthrough kwds that will be sent to pynndescent.</p></li>
<li><p><strong>return_graph</strong> (<em>bool</em>) – will return the graph instead of updating self.FG</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>There are LOTS of metric implemnted in pynndescent.
Many are not updated in the readthedocs so check the sources code!</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.build_spatial_graph">
<span class="sig-name descname"><span class="pre">build_spatial_graph</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">XYS</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.build_spatial_graph" title="Permalink to this definition">¶</a></dt>
<dd><p>construct graph based on Delauny neighbors</p>
<p>build_spatial_graph will create an igrah using Delaunay triangulation</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>XYS</strong> (<em>numpy Nx2</em><em> or </em><em>Nx3 array</em>) – </p></li>
<li><p><strong>around</strong> (<em>centroid regions to build a graph</em>) – if it’s only Nx2 assuming a single S=0</p></li>
<li><p><strong>X</strong> (<em>data is assumed to be Nx3 with</em>) – if it’s only Nx2 assuming a single S=0</p></li>
<li><p><strong>data</strong> (<em>Y and S</em><em> (</em><em>slice</em><em>)</em>) – if it’s only Nx2 assuming a single S=0</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.calc_entropy_at_different_Leiden_resolutions">
<span class="sig-name descname"><span class="pre">calc_entropy_at_different_Leiden_resolutions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Rvec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">array([1.00000000e-01,</span> <span class="pre">1.08480964e-01,</span> <span class="pre">1.17681195e-01,</span> <span class="pre">1.27661695e-01,</span> <span class="pre">1.38488637e-01,</span> <span class="pre">1.50233808e-01,</span> <span class="pre">1.62975083e-01,</span> <span class="pre">1.76796941e-01,</span> <span class="pre">1.91791026e-01,</span> <span class="pre">2.08056754e-01,</span> <span class="pre">2.25701972e-01,</span> <span class="pre">2.44843675e-01,</span> <span class="pre">2.65608778e-01,</span> <span class="pre">2.88134963e-01,</span> <span class="pre">3.12571585e-01,</span> <span class="pre">3.39080668e-01,</span> <span class="pre">3.67837977e-01,</span> <span class="pre">3.99034183e-01,</span> <span class="pre">4.32876128e-01,</span> <span class="pre">4.69588196e-01,</span> <span class="pre">5.09413801e-01,</span> <span class="pre">5.52617002e-01,</span> <span class="pre">5.99484250e-01,</span> <span class="pre">6.50326293e-01,</span> <span class="pre">7.05480231e-01,</span> <span class="pre">7.65311755e-01,</span> <span class="pre">8.30217568e-01,</span> <span class="pre">9.00628020e-01,</span> <span class="pre">9.77009957e-01,</span> <span class="pre">1.05986982e+00,</span> <span class="pre">1.14975700e+00,</span> <span class="pre">1.24726747e+00,</span> <span class="pre">1.35304777e+00,</span> <span class="pre">1.46779927e+00,</span> <span class="pre">1.59228279e+00,</span> <span class="pre">1.72732372e+00,</span> <span class="pre">1.87381742e+00,</span> <span class="pre">2.03273520e+00,</span> <span class="pre">2.20513074e+00,</span> <span class="pre">2.39214708e+00,</span> <span class="pre">2.59502421e+00,</span> <span class="pre">2.81510728e+00,</span> <span class="pre">3.05385551e+00,</span> <span class="pre">3.31285189e+00,</span> <span class="pre">3.59381366e+00,</span> <span class="pre">3.89860370e+00,</span> <span class="pre">4.22924287e+00,</span> <span class="pre">4.58792343e+00,</span> <span class="pre">4.97702356e+00,</span> <span class="pre">5.39912314e+00,</span> <span class="pre">5.85702082e+00,</span> <span class="pre">6.35375264e+00,</span> <span class="pre">6.89261210e+00,</span> <span class="pre">7.47717205e+00,</span> <span class="pre">8.11130831e+00,</span> <span class="pre">8.79922544e+00,</span> <span class="pre">9.54548457e+00,</span> <span class="pre">1.03550337e+01,</span> <span class="pre">1.12332403e+01,</span> <span class="pre">1.21859274e+01,</span> <span class="pre">1.32194115e+01,</span> <span class="pre">1.43405450e+01,</span> <span class="pre">1.55567614e+01,</span> <span class="pre">1.68761248e+01,</span> <span class="pre">1.83073828e+01,</span> <span class="pre">1.98600253e+01,</span> <span class="pre">2.15443469e+01,</span> <span class="pre">2.33715152e+01,</span> <span class="pre">2.53536449e+01,</span> <span class="pre">2.75038784e+01,</span> <span class="pre">2.98364724e+01,</span> <span class="pre">3.23668929e+01,</span> <span class="pre">3.51119173e+01,</span> <span class="pre">3.80897464e+01,</span> <span class="pre">4.13201240e+01,</span> <span class="pre">4.48244688e+01,</span> <span class="pre">4.86260158e+01,</span> <span class="pre">5.27499706e+01,</span> <span class="pre">5.72236766e+01,</span> <span class="pre">6.20767959e+01,</span> <span class="pre">6.73415066e+01,</span> <span class="pre">7.30527154e+01,</span> <span class="pre">7.92482898e+01,</span> <span class="pre">8.59693087e+01,</span> <span class="pre">9.32603347e+01,</span> <span class="pre">1.01169710e+02,</span> <span class="pre">1.09749877e+02,</span> <span class="pre">1.19057724e+02,</span> <span class="pre">1.29154967e+02,</span> <span class="pre">1.40108553e+02,</span> <span class="pre">1.51991108e+02,</span> <span class="pre">1.64881419e+02,</span> <span class="pre">1.78864953e+02,</span> <span class="pre">1.94034425e+02,</span> <span class="pre">2.10490414e+02,</span> <span class="pre">2.28342030e+02,</span> <span class="pre">2.47707636e+02,</span> <span class="pre">2.68715631e+02,</span> <span class="pre">2.91505306e+02,</span> <span class="pre">3.16227766e+02])</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.calc_entropy_at_different_Leiden_resolutions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.cond_entropy">
<span class="sig-name descname"><span class="pre">cond_entropy</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.cond_entropy" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate conditional entropy of the tissue graph</p>
<p>cond entropy is the difference between graph entropy based on zones and type entropy</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.contract_graph">
<span class="sig-name descname"><span class="pre">contract_graph</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">TypeVec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.contract_graph" title="Permalink to this definition">¶</a></dt>
<dd><p>find zones/region, i.e. spatially continous areas in the graph the same (cell/microenvironment) type</p>
<p>reduce graph size by merging spatial neighbors of same type.
Given a vector of types, will contract the graph to merge vertices that are both next to each other and of the same type.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>TypeVec</strong> (<em>1D numpy array with dtype int</em><em> (</em><em>default value is self.Type</em><em>)</em>) – a vector of Types for each node. If None, will use self.Type</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Default behavior is to assign the contracted TG the same taxonomy as the original graph.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A TG object after vertices merging.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="#Analysis.TissueGraph.TissueGraph" title="Analysis.TissueGraph.TissueGraph">TissueGraph</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.extract_environments">
<span class="sig-name descname"><span class="pre">extract_environments</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ordr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">typevec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.extract_environments" title="Permalink to this definition">¶</a></dt>
<dd><p>returns the categorical distribution of neighbors.</p>
<dl class="simple">
<dt>Depending on input there could be two uses,</dt><dd><p>usage 1: if ordr is not None returns local neighberhood defined as nodes up to distance ordr on the graph for all vertices.
usage 2: if typevec is not None returns local env based on typevec, will return one env for each unique type in typevec</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Array with Type frequency for all local environments for all types in TG.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>numpy array</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.feature_mat">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">feature_mat</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.feature_mat" title="Permalink to this definition">¶</a></dt>
<dd><p>the feature values for this TG observations</p>
<p>The feature_mat is stored in the underlying anndata object and is required to properly init it.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>matrix</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.gradient_magnitude">
<span class="sig-name descname"><span class="pre">gradient_magnitude</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.gradient_magnitude" title="Permalink to this definition">¶</a></dt>
<dd><p>Spatial gradient based on spatial graph</p>
<p>Calculate the gradient defined as sqrt(dV/dx^2+dV/dy^2) where dV/dx(y) is calcualted using simple trigo</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.graph_local_avg">
<span class="sig-name descname"><span class="pre">graph_local_avg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">VecToSmooth</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ordr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">array([0.4,</span> <span class="pre">0.3,</span> <span class="pre">0.2,</span> <span class="pre">0.1])</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.graph_local_avg" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple local average of a Vec based on local neighborgood</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>VecToSmooth</strong> (<em>numpy array</em>) – The values we want to smooth. len(VecToSmooth) must be self.N</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.graph_local_median">
<span class="sig-name descname"><span class="pre">graph_local_median</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">VecToSmooth</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ordr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.graph_local_median" title="Permalink to this definition">¶</a></dt>
<dd><p>local median of VecToSmooth based in spatial graph</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.is_empty">
<span class="sig-name descname"><span class="pre">is_empty</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.is_empty" title="Permalink to this definition">¶</a></dt>
<dd><p>Determines if the TG object is empty</p>
<p>Checks if internal adata is None of empty</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.names">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">names</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.names" title="Permalink to this definition">¶</a></dt>
<dd><p>observation names</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.node_size">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">node_size</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.node_size" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.save" title="Permalink to this definition">¶</a></dt>
<dd><p>save TG to file</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.type_freq">
<span class="sig-name descname"><span class="pre">type_freq</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.type_freq" title="Permalink to this definition">¶</a></dt>
<dd><p>return the catogorical probability for each type in TG</p>
<p>Probabilities are weighted by the node_size</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueGraph.watershed">
<span class="sig-name descname"><span class="pre">watershed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">InputVec</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueGraph.watershed" title="Permalink to this definition">¶</a></dt>
<dd><p>Watershed segmentation based on InputVec values</p>
<p>Watershed on the TG spatial graph.
First finds local peaks and then assigns all nodes to their closest local peak using dijkstra</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple with id and distance to cloest zone.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>(id,dist)</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueMultiGraph">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">Analysis.TissueGraph.</span></span><span class="sig-name descname"><span class="pre">TissueMultiGraph</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">basepath</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">redo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueMultiGraph" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Main class used to manage the creation of multi-layer graph representation of tissues.</p>
<p>TissueMultiGraph (TMG) acts as a factory to create objects that represents the state of different biospatial units in tissue,
and their relationships. Examples of biospatial units are cells, isozones, regions.
The main objects that TMG creates and stores are TissueGraphs, Taxonomies, and Geoms.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueMultiGraph.Layers">
<span class="sig-name descname"><span class="pre">Layers</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueMultiGraph.Layers" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the main spatial/feature data storage representing biospatial units (cells, isozones, and regions)</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueMultiGraph.Taxonomies">
<span class="sig-name descname"><span class="pre">Taxonomies</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueMultiGraph.Taxonomies" title="Permalink to this definition">¶</a></dt>
<dd><p>The taxonomical representation of the different types biospatial units can have.
There is a many-to-one relationship between TissueGraphs Layers and Taxonomies.
Multiple layers can have the same taxnomy (cells and isozones both have the same taxonomy).
The Taxonomies store type related information (full names, feature_type_mats, relationship between types, etc).</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueMultiGraph.Geoms">
<span class="sig-name descname"><span class="pre">Geoms</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueMultiGraph.Geoms" title="Permalink to this definition">¶</a></dt>
<dd><p>Geometrical aspects of the TMG required for Vizualization.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueMultiGraph.basepath">
<span class="sig-name descname"><span class="pre">basepath</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueMultiGraph.basepath" title="Permalink to this definition">¶</a></dt>
<dd><p>The base path with all TMG related files.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueMultiGraph.layers_graph">
<span class="sig-name descname"><span class="pre">layers_graph</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueMultiGraph.layers_graph" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores relatioship between layers.
For example, [(1,2),(1,3)] inducates that layer 2 used layer 1 (isozones are build on cells) and that layer 3 (regions) uses layer 1.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list of tuples</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueMultiGraph.layer_taxonomy_mapping">
<span class="sig-name descname"><span class="pre">layer_taxonomy_mapping</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueMultiGraph.layer_taxonomy_mapping" title="Permalink to this definition">¶</a></dt>
<dd><p>Stores relationship between TG layers and Taxonomies</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list of tuples</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueMultiGraph.N">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">N</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueMultiGraph.N" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of cells in each layer of TMG.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueMultiGraph.Ntypes">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">Ntypes</span></span><a class="headerlink" href="#Analysis.TissueGraph.TissueMultiGraph.Ntypes" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of types in each layer of TMG.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueMultiGraph.add_geoms">
<span class="sig-name descname"><span class="pre">add_geoms</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueMultiGraph.add_geoms" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates the geometies needed (boundingbox, lines, points, and polygons) to be used in views to create maps.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueMultiGraph.add_type_informations">
<span class="sig-name descname"><span class="pre">add_type_informations</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type_vec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tax</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueMultiGraph.add_type_informations" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds type information to TMG</p>
<p>Bookeeping method to add type information and update taxonomies etc.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>layer_id</strong> (<em>int</em>) – what layers are we adding type info to?</p></li>
<li><p><strong>type_vec</strong> (<em>numpy 1D array / list</em>) – the integer codes of type</p></li>
<li><p><strong>tax</strong> (<em>int / Taxonomy</em>) – either an integer that will be intepreted as an index to existing taxonomies or a Taxonomy object</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueMultiGraph.create_cell_layer">
<span class="sig-name descname"><span class="pre">create_cell_layer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cosine'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueMultiGraph.create_cell_layer" title="Permalink to this definition">¶</a></dt>
<dd><p>Creating cell layer from raw data.
TODO: Fix documentaion after finishing Taxonomy class.</p>
<p>Cell layer is unique as it’s the only one where spatial information is directly used with Voronoi</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>slices</strong><strong>)</strong> (<em>path_to_raw_data - path to folder with all raw-data</em><em> (</em><em>multiple</em>) – </p></li>
<li><p><strong>cells.</strong> (<em>celltypes_org - labels for</em>) – </p></li>
<li><p><strong>values</strong> (<em>expand_types - id of cell types to expand. If they are all the last</em>) – </p></li>
<li><p><strong>continous</strong> (<em>numbering will be</em>) – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueMultiGraph.create_isozone_layer">
<span class="sig-name descname"><span class="pre">create_isozone_layer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cell_layer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueMultiGraph.create_isozone_layer" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates isozones layer using cell types.</p>
<p>Contract cell types to create isozone graph.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueMultiGraph.create_region_layer">
<span class="sig-name descname"><span class="pre">create_region_layer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">topics</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">region_tax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cell_layer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueMultiGraph.create_region_layer" title="Permalink to this definition">¶</a></dt>
<dd><p>Add region layor given cells’ region types (topics)</p>
<p>Parameters
feature_mat : numpy array</p>
<blockquote>
<div><p>An array with local type environment</p>
</div></blockquote>
<p>Region features are local environments</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueMultiGraph.fill_holes">
<span class="sig-name descname"><span class="pre">fill_holes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lvl_to_fill</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_node_size</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueMultiGraph.fill_holes" title="Permalink to this definition">¶</a></dt>
<dd><p>EXPERIMENTAL: merges small biospatial units with their neighbors.</p>
<p>The goal of this method is to allow filling up “holes”, i.e. chunks in the tissue graph that we
are unhappy about their type using local neighbor types.</p>
<p class="rubric">Notes</p>
<p>As of 6/8/2022 this method is not ready for production use.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueMultiGraph.find_regions_edge_level">
<span class="sig-name descname"><span class="pre">find_regions_edge_level</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">region_layer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueMultiGraph.find_regions_edge_level" title="Permalink to this definition">¶</a></dt>
<dd><p>finds cells graph edges edges that are also region edges</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueMultiGraph.find_upstream_layer">
<span class="sig-name descname"><span class="pre">find_upstream_layer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer_id</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueMultiGraph.find_upstream_layer" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueMultiGraph.map_to_cell_level">
<span class="sig-name descname"><span class="pre">map_to_cell_level</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lvl</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">VecToMap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_ix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueMultiGraph.map_to_cell_level" title="Permalink to this definition">¶</a></dt>
<dd><p>Maps values to first layer of the graph, mostly used for plotting.
lvl is the level we want to map all the way to</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.TissueGraph.TissueMultiGraph.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.TissueGraph.TissueMultiGraph.save" title="Permalink to this definition">¶</a></dt>
<dd><p>create the TMG.json and save everything.</p>
<p>Saving scheme:
TissueGraphs in Layers and Taxonomies in Taxonomies are stored in a single anndata file per object according to theor own .save() method
Geoms are saved in Geom.json
mapping between layers and the names of different objects in layers (to be loaded and saved) are saved in a simple TMG.json file.</p>
</dd></dl>

</dd></dl>

</section>
<section id="analysis-tissuegraph-basics-module">
<h2>Analysis.TissueGraph_basics module<a class="headerlink" href="#analysis-tissuegraph-basics-module" title="Permalink to this heading">¶</a></h2>
</section>
<section id="analysis-untitled-1-module">
<h2>Analysis.Untitled-1 module<a class="headerlink" href="#analysis-untitled-1-module" title="Permalink to this heading">¶</a></h2>
</section>
<section id="module-Analysis.basicu">
<span id="analysis-basicu-module"></span><h2>Analysis.basicu module<a class="headerlink" href="#module-Analysis.basicu" title="Permalink to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="Analysis.basicu.clip_by_percentile">
<span class="sig-prename descclassname"><span class="pre">Analysis.basicu.</span></span><span class="sig-name descname"><span class="pre">clip_by_percentile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vector</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">low_p</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">high_p</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">95</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.basicu.clip_by_percentile" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.basicu.corr_paired_rows_fast">
<span class="sig-prename descclassname"><span class="pre">Analysis.basicu.</span></span><span class="sig-name descname"><span class="pre">corr_paired_rows_fast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'pearsonr'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.basicu.corr_paired_rows_fast" title="Permalink to this definition">¶</a></dt>
<dd><p>low memory compared to fast2</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.basicu.corr_paired_rows_fast2">
<span class="sig-prename descclassname"><span class="pre">Analysis.basicu.</span></span><span class="sig-name descname"><span class="pre">corr_paired_rows_fast2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">offset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nan_to_num</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'pearsonr'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.basicu.corr_paired_rows_fast2" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.basicu.diag_matrix">
<span class="sig-prename descclassname"><span class="pre">Analysis.basicu.</span></span><span class="sig-name descname"><span class="pre">diag_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rows</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">array([],</span> <span class="pre">dtype=float64)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cols</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">array([],</span> <span class="pre">dtype=float64)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.basicu.diag_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Diagonalize a matrix as much as possible
threshold controls the level of diagnalization
a smaller threshold enforces more number of strict diagnal values,
while encourages less number of free columns (quasi-diagnal)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.basicu.diag_matrix_rows">
<span class="sig-prename descclassname"><span class="pre">Analysis.basicu.</span></span><span class="sig-name descname"><span class="pre">diag_matrix_rows</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.basicu.diag_matrix_rows" title="Permalink to this definition">¶</a></dt>
<dd><p>Diagonalize a matrix as much as possible by only rearrange rows</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.basicu.encode_mat">
<span class="sig-prename descclassname"><span class="pre">Analysis.basicu.</span></span><span class="sig-name descname"><span class="pre">encode_mat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">entrysize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.basicu.encode_mat" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a matrix and a dictionary; map elements of a according to d
a - numpy array
d - dictionary</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.basicu.get_index_from_array">
<span class="sig-prename descclassname"><span class="pre">Analysis.basicu.</span></span><span class="sig-name descname"><span class="pre">get_index_from_array</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inqs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">na_rep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.basicu.get_index_from_array" title="Permalink to this definition">¶</a></dt>
<dd><p>Get index of array</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.basicu.group_mean">
<span class="sig-prename descclassname"><span class="pre">Analysis.basicu.</span></span><span class="sig-name descname"><span class="pre">group_mean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">groups</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group_order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expand</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.basicu.group_mean" title="Permalink to this definition">¶</a></dt>
<dd><p>mat is a matrix (cell-by-feature) ; group are the labels (for each cell).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.basicu.group_sum">
<span class="sig-prename descclassname"><span class="pre">Analysis.basicu.</span></span><span class="sig-name descname"><span class="pre">group_sum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">groups</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group_order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.basicu.group_sum" title="Permalink to this definition">¶</a></dt>
<dd><p>mat is a matrix (cell-by-feature) ; group are the labels (for each cell).</p>
<p>this can be speed up!!! take advantage of the cluster label structure… check my metacell analysis script as well</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.basicu.libsize_norm">
<span class="sig-prename descclassname"><span class="pre">Analysis.basicu.</span></span><span class="sig-name descname"><span class="pre">libsize_norm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mat</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.basicu.libsize_norm" title="Permalink to this definition">¶</a></dt>
<dd><p>cell by gene matrix, norm to median library size
assume the matrix is in sparse format, the output will keep sparse</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.basicu.rank">
<span class="sig-prename descclassname"><span class="pre">Analysis.basicu.</span></span><span class="sig-name descname"><span class="pre">rank</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arr</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.basicu.rank" title="Permalink to this definition">¶</a></dt>
<dd><p>rank is equivalent to argsort twice</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.basicu.rank_array">
<span class="sig-prename descclassname"><span class="pre">Analysis.basicu.</span></span><span class="sig-name descname"><span class="pre">rank_array</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.basicu.rank_array" title="Permalink to this definition">¶</a></dt>
<dd><p>Return ranking of each element of an array</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.basicu.rank_rows">
<span class="sig-prename descclassname"><span class="pre">Analysis.basicu.</span></span><span class="sig-name descname"><span class="pre">rank_rows</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">matrix</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.basicu.rank_rows" title="Permalink to this definition">¶</a></dt>
<dd><p>Return rankings of each rwo in a 2d array</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.basicu.reset_logging">
<span class="sig-prename descclassname"><span class="pre">Analysis.basicu.</span></span><span class="sig-name descname"><span class="pre">reset_logging</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.basicu.reset_logging" title="Permalink to this definition">¶</a></dt>
<dd><p>reset logging.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.basicu.sparse_libsize_norm">
<span class="sig-prename descclassname"><span class="pre">Analysis.basicu.</span></span><span class="sig-name descname"><span class="pre">sparse_libsize_norm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mat</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.basicu.sparse_libsize_norm" title="Permalink to this definition">¶</a></dt>
<dd><p>cell by gene matrix, norm to median library size
assume the matrix is in sparse format, the output will keep sparse</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.basicu.spearman_corrcoef">
<span class="sig-prename descclassname"><span class="pre">Analysis.basicu.</span></span><span class="sig-name descname"><span class="pre">spearman_corrcoef</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Y</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.basicu.spearman_corrcoef" title="Permalink to this definition">¶</a></dt>
<dd><p>return spearman correlation matrix for each pair of rows of X and Y</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.basicu.spearmanr_paired_rows">
<span class="sig-prename descclassname"><span class="pre">Analysis.basicu.</span></span><span class="sig-name descname"><span class="pre">spearmanr_paired_rows</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Y</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.basicu.spearmanr_paired_rows" title="Permalink to this definition">¶</a></dt>
<dd><p>with p-value, slow</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.basicu.stratified_sample">
<span class="sig-prename descclassname"><span class="pre">Analysis.basicu.</span></span><span class="sig-name descname"><span class="pre">stratified_sample</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_idx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group_keys</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sort</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.basicu.stratified_sample" title="Permalink to this definition">¶</a></dt>
<dd><p>n (int) represents the number for each group
n (dict) can be used to sample different numbers for each group</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.basicu.zscore">
<span class="sig-prename descclassname"><span class="pre">Analysis.basicu.</span></span><span class="sig-name descname"><span class="pre">zscore</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">v</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_nan</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.basicu.zscore" title="Permalink to this definition">¶</a></dt>
<dd><p>v is an numpy array (any dimensional)</p>
<p><a href="#id5"><span class="problematic" id="id6">**</span></a>kwargs are arguments of np.mean and np.std, such as</p>
<p>axis=0 # zscore across rows for each column (if v is 2-dimensional)
axis=1 # zscore across cols for each row  (if v is 2-dimensional)</p>
</dd></dl>

</section>
<section id="module-Analysis.celltypeu">
<span id="analysis-celltypeu-module"></span><h2>Analysis.celltypeu module<a class="headerlink" href="#module-Analysis.celltypeu" title="Permalink to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="Analysis.celltypeu.CellTypeClassify">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">Analysis.celltypeu.</span></span><span class="sig-name descname"><span class="pre">CellTypeClassify</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_refdata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_refdata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.celltypeu.CellTypeClassify" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="Analysis.celltypeu.CellTypeClassify.backup">
<span class="sig-name descname"><span class="pre">backup</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.celltypeu.CellTypeClassify.backup" title="Permalink to this definition">¶</a></dt>
<dd><p>save a copy</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.celltypeu.CellTypeClassify.buildModel">
<span class="sig-name descname"><span class="pre">buildModel</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.celltypeu.CellTypeClassify.buildModel" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.celltypeu.CellTypeClassify.classBalance">
<span class="sig-name descname"><span class="pre">classBalance</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_cells</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.celltypeu.CellTypeClassify.classBalance" title="Permalink to this definition">¶</a></dt>
<dd><p>Class Balance  the reference data
select <cite>n_cells</cite> from each cluster without replacement
if n_cells &gt; cluster size, it selects <strong>all</strong> cells</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.celltypeu.CellTypeClassify.normalizeData">
<span class="sig-name descname"><span class="pre">normalizeData</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'per_bit'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.celltypeu.CellTypeClassify.normalizeData" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.celltypeu.CellTypeClassify.predictLabels">
<span class="sig-name descname"><span class="pre">predictLabels</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.celltypeu.CellTypeClassify.predictLabels" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.celltypeu.CellTypeClassify.rankNorm">
<span class="sig-name descname"><span class="pre">rankNorm</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.celltypeu.CellTypeClassify.rankNorm" title="Permalink to this definition">¶</a></dt>
<dd><p>rank normalize across bits</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.celltypeu.CellTypeClassify.reset">
<span class="sig-name descname"><span class="pre">reset</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.celltypeu.CellTypeClassify.reset" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.celltypeu.CellTypeClassify.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ranknorm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_cells</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.celltypeu.CellTypeClassify.run" title="Permalink to this definition">¶</a></dt>
<dd><p>sample, normalize, classify</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.celltypeu.CellTypeClassify.run_bagging">
<span class="sig-name descname"><span class="pre">run_bagging</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_estimators</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ranknorm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_cells</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.celltypeu.CellTypeClassify.run_bagging" title="Permalink to this definition">¶</a></dt>
<dd><p>repeat the same algorithm for different subsets of samples several time, taking the average as the results</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.celltypeu.CellTypeClassify.run_iterative_prior">
<span class="sig-name descname"><span class="pre">run_iterative_prior</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">overall_sample_fraction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_total_cells</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_cells</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p0</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subrun_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'run'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'per_bit_equalscale'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ranknorm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.celltypeu.CellTypeClassify.run_iterative_prior" title="Permalink to this definition">¶</a></dt>
<dd><p>Iteratively set up the number of cell to sample, control overall sample fraction</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.celltypeu.CellTypeClassify.run_iterative_prior_v2">
<span class="sig-name descname"><span class="pre">run_iterative_prior_v2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">min_cells_pertype</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_ratio</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_cells</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p0</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subrun_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'run'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'per_bit_equalscale'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ranknorm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.celltypeu.CellTypeClassify.run_iterative_prior_v2" title="Permalink to this definition">¶</a></dt>
<dd><p>Iteratively set up the number of cell to sample, control baseline number of cells</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.celltypeu.CellTypeClassify.trainModel">
<span class="sig-name descname"><span class="pre">trainModel</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.celltypeu.CellTypeClassify.trainModel" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.celltypeu.iterative_classify">
<span class="sig-prename descclassname"><span class="pre">Analysis.celltypeu.</span></span><span class="sig-name descname"><span class="pre">iterative_classify</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_refdata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Y_refdata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">levels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">run_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'run'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">run_kwargs_perlevel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_internal_failure</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.celltypeu.iterative_classify" title="Permalink to this definition">¶</a></dt>
<dd><p>allow kwargs per level</p>
</dd></dl>

</section>
<section id="module-Analysis.evalu">
<span id="analysis-evalu-module"></span><h2>Analysis.evalu module<a class="headerlink" href="#module-Analysis.evalu" title="Permalink to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="Analysis.evalu.Level3Res">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">Analysis.evalu.</span></span><span class="sig-name descname"><span class="pre">Level3Res</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">meta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">levels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refdata_anndata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_anndata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refdata_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'scRNA-seq'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'dredFISH'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_layer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'norm_cell'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">embed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">df_embed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.evalu.Level3Res" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="Analysis.evalu.Level3Res.get_cell_level">
<span class="sig-name descname"><span class="pre">get_cell_level</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nsample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Y'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm_bits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reorder_bits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.evalu.Level3Res.get_cell_level" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.evalu.Level3Res.get_cluster_level">
<span class="sig-name descname"><span class="pre">get_cluster_level</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.evalu.Level3Res.get_cluster_level" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.evalu.Level3Res.get_umap">
<span class="sig-name descname"><span class="pre">get_umap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.evalu.Level3Res.get_umap" title="Permalink to this definition">¶</a></dt>
<dd><p>Working but slow</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.evalu.Level3Res.plot_embeds">
<span class="sig-name descname"><span class="pre">plot_embeds</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hues</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.evalu.Level3Res.plot_embeds" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.evalu.Level3Res.plot_genes">
<span class="sig-name descname"><span class="pre">plot_genes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nsample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.evalu.Level3Res.plot_genes" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.evalu.Level3Res.plot_spatial">
<span class="sig-name descname"><span class="pre">plot_spatial</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.evalu.Level3Res.plot_spatial" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.evalu.compare_cluster_pearsonr">
<span class="sig-prename descclassname"><span class="pre">Analysis.evalu.</span></span><span class="sig-name descname"><span class="pre">compare_cluster_pearsonr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Xmat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ymat</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.evalu.compare_cluster_pearsonr" title="Permalink to this definition">¶</a></dt>
<dd><p>matched rows</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.evalu.plot_embed">
<span class="sig-prename descclassname"><span class="pre">Analysis.evalu.</span></span><span class="sig-name descname"><span class="pre">plot_embed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dfembed</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hue</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.evalu.plot_embed" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.evalu.plot_validation_genes_cluster_r">
<span class="sig-prename descclassname"><span class="pre">Analysis.evalu.</span></span><span class="sig-name descname"><span class="pre">plot_validation_genes_cluster_r</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Xmat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ymat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xlabel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'scRNA-seq'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ylabel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'dredFIS'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.evalu.plot_validation_genes_cluster_r" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.evalu.plot_validation_genes_level3">
<span class="sig-prename descclassname"><span class="pre">Analysis.evalu.</span></span><span class="sig-name descname"><span class="pre">plot_validation_genes_level3</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Xmat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ymat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">splitat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">splitat_v</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">xtitle</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'scRNA-seq'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ytitle</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'dredFISH'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_rows_in_both_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">figsize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(12,</span> <span class="pre">10)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outpath</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.evalu.plot_validation_genes_level3" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.evalu.plot_validation_genes_level3_expand">
<span class="sig-prename descclassname"><span class="pre">Analysis.evalu.</span></span><span class="sig-name descname"><span class="pre">plot_validation_genes_level3_expand</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Ymat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clst_sizes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">splitat_v</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ylabel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'dredFISH'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.evalu.plot_validation_genes_level3_expand" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.evalu.plot_validation_spatial_level3">
<span class="sig-prename descclassname"><span class="pre">Analysis.evalu.</span></span><span class="sig-name descname"><span class="pre">plot_validation_spatial_level3</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hue_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hue_order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">palette</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.evalu.plot_validation_spatial_level3" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.evalu.plot_validation_spatial_level3_expand">
<span class="sig-prename descclassname"><span class="pre">Analysis.evalu.</span></span><span class="sig-name descname"><span class="pre">plot_validation_spatial_level3_expand</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hue_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hue_order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">palette</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.evalu.plot_validation_spatial_level3_expand" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.evalu.plot_validation_spatial_level3_expand_v2">
<span class="sig-prename descclassname"><span class="pre">Analysis.evalu.</span></span><span class="sig-name descname"><span class="pre">plot_validation_spatial_level3_expand_v2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hue_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">huegroup_col</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">huegroup_order</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.evalu.plot_validation_spatial_level3_expand_v2" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.evalu.variance_explained">
<span class="sig-prename descclassname"><span class="pre">Analysis.evalu.</span></span><span class="sig-name descname"><span class="pre">variance_explained</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Xmat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ymat</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.evalu.variance_explained" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-Analysis.imageu">
<span id="analysis-imageu-module"></span><h2>Analysis.imageu module<a class="headerlink" href="#module-Analysis.imageu" title="Permalink to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="Analysis.imageu.block_downsamp_3d">
<span class="sig-prename descclassname"><span class="pre">Analysis.imageu.</span></span><span class="sig-name descname"><span class="pre">block_downsamp_3d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ar</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fact</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.imageu.block_downsamp_3d" title="Permalink to this definition">¶</a></dt>
<dd><p>Downsample an 2d numpy array by a factor; taking the block mean</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.imageu.block_mean">
<span class="sig-prename descclassname"><span class="pre">Analysis.imageu.</span></span><span class="sig-name descname"><span class="pre">block_mean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ar</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fact</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.imageu.block_mean" title="Permalink to this definition">¶</a></dt>
<dd><p>Downsample an 2d numpy array by a factor; taking the block mean</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.imageu.broad_padding">
<span class="sig-prename descclassname"><span class="pre">Analysis.imageu.</span></span><span class="sig-name descname"><span class="pre">broad_padding</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">moving</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fixed_shape</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.imageu.broad_padding" title="Permalink to this definition">¶</a></dt>
<dd><p>match CCF padding
assume moving image is a subset of CCF</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.imageu.coords_to_imgidx">
<span class="sig-prename descclassname"><span class="pre">Analysis.imageu.</span></span><span class="sig-name descname"><span class="pre">coords_to_imgidx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xcoords</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ycoords</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coordmat</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.imageu.coords_to_imgidx" title="Permalink to this definition">¶</a></dt>
<dd><p>coordmat - 2d array [[xmin, ymin], [xr, yr]]</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.imageu.flip_points">
<span class="sig-prename descclassname"><span class="pre">Analysis.imageu.</span></span><span class="sig-name descname"><span class="pre">flip_points</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">points</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.imageu.flip_points" title="Permalink to this definition">¶</a></dt>
<dd><p>assume a n*2 matrix</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.imageu.get_img_centroid">
<span class="sig-prename descclassname"><span class="pre">Analysis.imageu.</span></span><span class="sig-name descname"><span class="pre">get_img_centroid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.imageu.get_img_centroid" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.imageu.image_to_pointset">
<span class="sig-prename descclassname"><span class="pre">Analysis.imageu.</span></span><span class="sig-name descname"><span class="pre">image_to_pointset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">imgmat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">preserve_intensity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.imageu.image_to_pointset" title="Permalink to this definition">¶</a></dt>
<dd><p>Assume imgmat is non-negative. Turn non-zero pixels into points.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.imageu.imgidx_to_coords">
<span class="sig-prename descclassname"><span class="pre">Analysis.imageu.</span></span><span class="sig-name descname"><span class="pre">imgidx_to_coords</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rowidx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">colidx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coordmat</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.imageu.imgidx_to_coords" title="Permalink to this definition">¶</a></dt>
<dd><p>coordmat - 2d array [[xmin, ymin], [xr, yr]]</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.imageu.max_norm">
<span class="sig-prename descclassname"><span class="pre">Analysis.imageu.</span></span><span class="sig-name descname"><span class="pre">max_norm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ar</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">99</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.imageu.max_norm" title="Permalink to this definition">¶</a></dt>
<dd><p>To [0-1], assume the array contains non-negative elements; maxp specify the percentile to clip</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.imageu.pca_rotate">
<span class="sig-prename descclassname"><span class="pre">Analysis.imageu.</span></span><span class="sig-name descname"><span class="pre">pca_rotate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pmat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_reflection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vec_chiral</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">array([],</span> <span class="pre">dtype=float64)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.imageu.pca_rotate" title="Permalink to this definition">¶</a></dt>
<dd><p>(n,2) matrix as input (point set)
learn a rotation/reflection along PC1 and PC2.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.imageu.pointset_to_image">
<span class="sig-prename descclassname"><span class="pre">Analysis.imageu.</span></span><span class="sig-name descname"><span class="pre">pointset_to_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pmat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resolution</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_coords</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.imageu.pointset_to_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate heatmap based on pointset</p>
<p>resolution is approximate, it was adjusted according to rounding error (number of pixels)
ds.Canvas rasterize the pointset by (nx, ny) equal-sized bins.
coordinates can be recovered by</p>
<p>xcoords = xmin + xr*(1/2 + col(x)_index) # coords represents the min-points of each bin
ycoords = ymin + yr*(1/2 + row(y)_index)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.imageu.remove_zero_paddings">
<span class="sig-prename descclassname"><span class="pre">Analysis.imageu.</span></span><span class="sig-name descname"><span class="pre">remove_zero_paddings</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">imgmat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.imageu.remove_zero_paddings" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-Analysis.powerplots">
<span id="analysis-powerplots-module"></span><h2>Analysis.powerplots module<a class="headerlink" href="#module-Analysis.powerplots" title="Permalink to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="Analysis.powerplots.CategoricalColors">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">CategoricalColors</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">colors=[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">basis_cmap=&lt;matplotlib.colors.LinearSegmentedColormap</span> <span class="pre">object&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.CategoricalColors" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Arguments: labels, [colors]</p>
<dl class="py method">
<dt class="sig sig-object py" id="Analysis.powerplots.CategoricalColors.add_colorbar">
<span class="sig-name descname"><span class="pre">add_colorbar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fig</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cax_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0.95,</span> <span class="pre">0.1,</span> <span class="pre">0.05,</span> <span class="pre">0.8]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fontsize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.CategoricalColors.add_colorbar" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.powerplots.CategoricalColors.gen_cmap">
<span class="sig-name descname"><span class="pre">gen_cmap</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.CategoricalColors.gen_cmap" title="Permalink to this definition">¶</a></dt>
<dd><p>Use a list of colors to generate a categorical cmap
which maps</p>
<blockquote>
<div><p>[0, 1) -&gt; self.colors[0]
[1, 2) -&gt; self.colors[1]
[2, 3) -&gt; self.colors[2]
[3, 4) -&gt; self.colors[3]
…</p>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.powerplots.CategoricalColors.to_dict">
<span class="sig-name descname"><span class="pre">to_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">to_hex</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.CategoricalColors.to_dict" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="Analysis.powerplots.PlotScale">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">PlotScale</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rangex</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rangey</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">npxlx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">npxly</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pxl_scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.PlotScale" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>arguments: rangex, rangey, [npxlx, npxly, pxl_scale]</p>
<p>one of the three in [] will be required</p>
<dl class="py method">
<dt class="sig sig-object py" id="Analysis.powerplots.PlotScale.check_dim">
<span class="sig-name descname"><span class="pre">check_dim</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.PlotScale.check_dim" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.powerplots.PlotScale.len2pixel">
<span class="sig-name descname"><span class="pre">len2pixel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">length</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.PlotScale.len2pixel" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.powerplots.PlotScale.pixel2len">
<span class="sig-name descname"><span class="pre">pixel2len</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">npixel</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.PlotScale.pixel2len" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.add_arrows">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">add_arrows</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fontsize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">px</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">py</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">0.01</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.add_arrows" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.add_colorbar">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">add_colorbar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fig</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vmaxp=99</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmap=&lt;matplotlib.colors.ListedColormap</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.add_colorbar" title="Permalink to this definition">¶</a></dt>
<dd><p>[log10(normalized_counts+1)] further normed by the 99% highest expression)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.add_colorbar_unified_colorbar">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">add_colorbar_unified_colorbar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fig</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vmin=0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vmax=0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmap=&lt;matplotlib.colors.ListedColormap</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.add_colorbar_unified_colorbar" title="Permalink to this definition">¶</a></dt>
<dd><p>User specified vmin and vmax</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.add_scalebar">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">add_scalebar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">left</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">right</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fontsize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax_y</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-</span> <span class="pre">0.01</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.add_scalebar" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.agg_count_cat">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">agg_count_cat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale_paras</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clip_max</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reduce</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sharp_boundary</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.agg_count_cat" title="Permalink to this definition">¶</a></dt>
<dd><p>count categorical data</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.agg_data">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">agg_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">npxlx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">npxly</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">agg</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.agg_data" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.agg_data_count">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">agg_data_count</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">npxlx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">npxly</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.agg_data_count" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.agg_data_ps">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">agg_data_ps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">agg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale_paras</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.agg_data_ps" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.gen_cdf">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">gen_cdf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_points</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flip</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.gen_cdf" title="Permalink to this definition">¶</a></dt>
<dd><p>returns x and y values</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.hex_to_rgb">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">hex_to_rgb</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hex_string</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.hex_to_rgb" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.imshow_routine">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">imshow_routine</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggdata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmap=&lt;matplotlib.colors.ListedColormap</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vmin=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vmax=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">origin='lower'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aspect='equal'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">**kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.imshow_routine" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.massive_scatterplot">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">massive_scatterplot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">npxlx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">npxly</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">agg=&lt;datashader.reductions.count</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmap=&lt;matplotlib.colors.ListedColormap</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vmin=0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vmax=0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vmaxp=99</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.massive_scatterplot" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.massive_scatterplot_withticks">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">massive_scatterplot_withticks</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">npxlx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">npxly</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aspect</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'auto'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">color_logscale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.massive_scatterplot_withticks" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.plot_cluster_insitu_routine">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">plot_cluster_insitu_routine</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggdata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hue</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zlabel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">arrows</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scalebar</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.plot_cluster_insitu_routine" title="Permalink to this definition">¶</a></dt>
<dd><p>ps - an instance of PlotScale</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.plot_cluster_umap_routine">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">plot_cluster_umap_routine</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggdata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hue</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">zlabel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">arrows</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scalebar</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.plot_cluster_umap_routine" title="Permalink to this definition">¶</a></dt>
<dd><p>ps - an instance of PlotScale</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.plot_gene_insitu_routine">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">plot_gene_insitu_routine</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hue</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale_paras</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">arrows</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scalebar</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vmaxp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">99</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vmin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vmax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.plot_gene_insitu_routine" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.plot_gene_umap_routine">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">plot_gene_umap_routine</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hue</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale_paras</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">arrows</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vmaxp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">99</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.plot_gene_umap_routine" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.plot_hybrid_mat_mask">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">plot_hybrid_mat_mask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">_mat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.plot_hybrid_mat_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>show matrix and masks in left and right halves</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.rgb_to_hex">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">rgb_to_hex</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">r</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">g</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.rgb_to_hex" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.savefig">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">savefig</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fig</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.savefig" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.savefig_autodate">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">savefig_autodate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fig</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.savefig_autodate" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.set_vmin_vmax">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">set_vmin_vmax</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">numbers</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vmaxp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">99</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.set_vmin_vmax" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.powerplots.spatial_histogram">
<span class="sig-prename descclassname"><span class="pre">Analysis.powerplots.</span></span><span class="sig-name descname"><span class="pre">spatial_histogram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale_para</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cmap=&lt;matplotlib.colors.ListedColormap</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vmin=0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vmax=0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vmaxp=100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">agg=&lt;datashader.reductions.count</span> <span class="pre">object&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.powerplots.spatial_histogram" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-Analysis.regu">
<span id="analysis-regu-module"></span><h2>Analysis.regu module<a class="headerlink" href="#module-Analysis.regu" title="Permalink to this heading">¶</a></h2>
<p>Utilities for spatial registration of dredFISH/MERFISH data</p>
<dl class="py class">
<dt class="sig sig-object py" id="Analysis.regu.Data">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">Analysis.regu.</span></span><span class="sig-name descname"><span class="pre">Data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">points_raw</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.Data" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>self.points_raw – starting point
self.points_rot – after rotation</p>
<p>self.img_rot – image after
self.img_rotpad – image aligned
self.img_affine = ..
self.img_reg = ..</p>
<p>self.trans_rot
self.trans_pad</p>
<p>self.img_rot_coords</p>
<p>self.ccfidx – matched CCF plate index
self.img_ccf_template – matched CCF template
self.img_ccf_annot – matched CCF annotation (sid)</p>
<dl class="py method">
<dt class="sig sig-object py" id="Analysis.regu.Data.add_affine">
<span class="sig-name descname"><span class="pre">add_affine</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reg</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.Data.add_affine" title="Permalink to this definition">¶</a></dt>
<dd><p>Record affine results</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.regu.Data.add_matched_ccf">
<span class="sig-name descname"><span class="pre">add_matched_ccf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">idx_ccf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">img_ccf_template</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">img_ccf_annot</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.Data.add_matched_ccf" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.regu.Data.add_syn">
<span class="sig-name descname"><span class="pre">add_syn</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reg</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.Data.add_syn" title="Permalink to this definition">¶</a></dt>
<dd><p>Record syn results</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.regu.Data.apply_inv_transformation">
<span class="sig-name descname"><span class="pre">apply_inv_transformation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img_mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'moved'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interpolator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nearestNeighbor'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">has_components</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.Data.apply_inv_transformation" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.regu.Data.apply_transformation">
<span class="sig-name descname"><span class="pre">apply_transformation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'register'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interpolator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'linear'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.Data.apply_transformation" title="Permalink to this definition">¶</a></dt>
<dd><p>Mode: choose from
- preproc
- affine
- register</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.regu.Data.assign_region_ids">
<span class="sig-name descname"><span class="pre">assign_region_ids</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'moved'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.Data.assign_region_ids" title="Permalink to this definition">¶</a></dt>
<dd><p>For each point (cell), assign region id from the mask
the mask is presumably from the Allen Brain Atlas (regions are coded)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.regu.Data.flip_rotated">
<span class="sig-name descname"><span class="pre">flip_rotated</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.Data.flip_rotated" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.regu.Data.pad">
<span class="sig-name descname"><span class="pre">pad</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fixed_shape</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.Data.pad" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.regu.Data.pca_rotate">
<span class="sig-name descname"><span class="pre">pca_rotate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.Data.pca_rotate" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.regu.Data.render_affine_comparison">
<span class="sig-name descname"><span class="pre">render_affine_comparison</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.Data.render_affine_comparison" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.regu.Data.render_all_comparison">
<span class="sig-name descname"><span class="pre">render_all_comparison</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.Data.render_all_comparison" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.regu.Data.render_flow">
<span class="sig-name descname"><span class="pre">render_flow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dfactor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">30</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.Data.render_flow" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.regu.Data.render_img">
<span class="sig-name descname"><span class="pre">render_img</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mode</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.Data.render_img" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.regu.Data.render_sanity_check">
<span class="sig-name descname"><span class="pre">render_sanity_check</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.Data.render_sanity_check" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.regu.Data.render_syn_comparison">
<span class="sig-name descname"><span class="pre">render_syn_comparison</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">flow</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.Data.render_syn_comparison" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.regu.Data.run_affine">
<span class="sig-name descname"><span class="pre">run_affine</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outprefix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">downsample_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type_of_transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Affine'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aff_metric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'GC'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grad_step</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flow_sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">total_sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aff_iterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(1000,</span> <span class="pre">1000,</span> <span class="pre">1000)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aff_shrink_factors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(10,</span> <span class="pre">4,</span> <span class="pre">2)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aff_smoothing_sigmas</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(2,</span> <span class="pre">2,</span> <span class="pre">1)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aff_sampling</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.Data.run_affine" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.regu.Data.run_syn">
<span class="sig-name descname"><span class="pre">run_syn</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outprefix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">downsample_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type_of_transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'SyNOnly'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">syn_metric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'MI'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">syn_sampling</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grad_step</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flow_sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">total_sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reg_iterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(100,</span> <span class="pre">100,</span> <span class="pre">50,</span> <span class="pre">30,</span> <span class="pre">0)</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.Data.run_syn" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="Analysis.regu.Data.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.Data.save" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.regu.check_run">
<span class="sig-prename descclassname"><span class="pre">Analysis.regu.</span></span><span class="sig-name descname"><span class="pre">check_run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">XY</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ccf_template</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ccf_annot</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ccf_maps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idx_ccf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flip</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.check_run" title="Permalink to this definition">¶</a></dt>
<dd><p>A n by 2 matrix of cell locations
ccf_template and ccf_annot are 3-dimensional matrices of the same shape</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.regu.expand_regions">
<span class="sig-prename descclassname"><span class="pre">Analysis.regu.</span></span><span class="sig-name descname"><span class="pre">expand_regions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">allen_tree</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">by</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'acronym'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.expand_regions" title="Permalink to this definition">¶</a></dt>
<dd><p>get all regions (their sid) belong to the specified regions.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.regu.load_allen_annot">
<span class="sig-prename descclassname"><span class="pre">Analysis.regu.</span></span><span class="sig-name descname"><span class="pre">load_allen_annot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">allen_annot_path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.load_allen_annot" title="Permalink to this definition">¶</a></dt>
<dd><p>Need to encode Allen regions to smaller integers so it does not get lost in float32 transformation and back during ANTs registration.
- <cite>uint32</cite> is the native dtype of Allen, and is supported as an input to ANTs</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.regu.load_allen_template">
<span class="sig-prename descclassname"><span class="pre">Analysis.regu.</span></span><span class="sig-name descname"><span class="pre">load_allen_template</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">allen_template_path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.load_allen_template" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.regu.load_allen_tree">
<span class="sig-prename descclassname"><span class="pre">Analysis.regu.</span></span><span class="sig-name descname"><span class="pre">load_allen_tree</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">allen_tree_path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.load_allen_tree" title="Permalink to this definition">¶</a></dt>
<dd><p>Need to encode Allen regions to smaller integers so it does not get lost in float32 transformation and back during ANTs registration.
- <cite>uint32</cite> is the native dtype of Allen, and is supported as an input to ANTs</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.regu.read_registered_data">
<span class="sig-prename descclassname"><span class="pre">Analysis.regu.</span></span><span class="sig-name descname"><span class="pre">read_registered_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.read_registered_data" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.regu.real_run">
<span class="sig-prename descclassname"><span class="pre">Analysis.regu.</span></span><span class="sig-name descname"><span class="pre">real_run</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">XY</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ccf_template</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ccf_annot</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ccf_maps</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idx_ccf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flip</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'FISHdata'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outprefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type_of_transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'SyNOnly'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">syn_metric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'MI'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">syn_sampling</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grad_step</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flow_sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">total_sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reg_iterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(100,</span> <span class="pre">100,</span> <span class="pre">50,</span> <span class="pre">30,</span> <span class="pre">0)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.regu.real_run" title="Permalink to this definition">¶</a></dt>
<dd><p>A n by 2 matrix of cell locations</p>
</dd></dl>

</section>
<section id="module-Analysis.statu">
<span id="analysis-statu-module"></span><h2>Analysis.statu module<a class="headerlink" href="#module-Analysis.statu" title="Permalink to this heading">¶</a></h2>
<p>Utilities related to statistical analysis (distance metrics, etc) used by TMG</p>
<dl class="py function">
<dt class="sig sig-object py" id="Analysis.statu.count_values">
<span class="sig-prename descclassname"><span class="pre">Analysis.statu.</span></span><span class="sig-name descname"><span class="pre">count_values</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">V</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refvals</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sz</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm_to_one</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.statu.count_values" title="Permalink to this definition">¶</a></dt>
<dd><p>count_values - simple tabulation with default values (refvals)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.statu.dist_emd">
<span class="sig-prename descclassname"><span class="pre">Analysis.statu.</span></span><span class="sig-name descname"><span class="pre">dist_emd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">E1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">E2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Dsim</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.statu.dist_emd" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.statu.dist_jsd">
<span class="sig-prename descclassname"><span class="pre">Analysis.statu.</span></span><span class="sig-name descname"><span class="pre">dist_jsd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">M1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.statu.dist_jsd" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="Analysis.statu.lda_fit">
<span class="sig-prename descclassname"><span class="pre">Analysis.statu.</span></span><span class="sig-name descname"><span class="pre">lda_fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_topics</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Env</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Analysis.statu.lda_fit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-Analysis.untitled">
<span id="analysis-untitled-module"></span><h2>Analysis.untitled module<a class="headerlink" href="#module-Analysis.untitled" title="Permalink to this heading">¶</a></h2>
</section>
<section id="module-Analysis">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-Analysis" title="Permalink to this heading">¶</a></h2>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Analysis package</a><ul>
<li><a class="reference internal" href="#submodules">Submodules</a></li>
<li><a class="reference internal" href="#module-Analysis.Classification">Analysis.Classification module</a></li>
<li><a class="reference internal" href="#module-Analysis.TissueGraph">Analysis.TissueGraph module</a></li>
<li><a class="reference internal" href="#analysis-tissuegraph-basics-module">Analysis.TissueGraph_basics module</a></li>
<li><a class="reference internal" href="#analysis-untitled-1-module">Analysis.Untitled-1 module</a></li>
<li><a class="reference internal" href="#module-Analysis.basicu">Analysis.basicu module</a></li>
<li><a class="reference internal" href="#module-Analysis.celltypeu">Analysis.celltypeu module</a></li>
<li><a class="reference internal" href="#module-Analysis.evalu">Analysis.evalu module</a></li>
<li><a class="reference internal" href="#module-Analysis.imageu">Analysis.imageu module</a></li>
<li><a class="reference internal" href="#module-Analysis.powerplots">Analysis.powerplots module</a></li>
<li><a class="reference internal" href="#module-Analysis.regu">Analysis.regu module</a></li>
<li><a class="reference internal" href="#module-Analysis.statu">Analysis.statu module</a></li>
<li><a class="reference internal" href="#module-Analysis.untitled">Analysis.untitled module</a></li>
<li><a class="reference internal" href="#module-Analysis">Module contents</a></li>
</ul>
</li>
</ul>

  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/Docs/Analysis.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">dredFISH  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Analysis package</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Wollman lab.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.1.
    </div>
  </body>
</html>